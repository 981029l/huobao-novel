/**
 * Chapter Prompts - 章节类提示词 (番茄小说/网文特供版)
 * 核心逻辑：黄金三章、快节奏、每章一爽、断章钩子
 */

/**
 * 章节大纲提示词（一次性生成）
 * 黄金三章 + 爽点节奏
 */
export const blueprint = (params) => `
基于以下元素：
- 内容指导：${params.userGuidance || '无'}
- 小说架构：
${params.novelArchitecture}

请设计${params.numberOfChapters}章的番茄连载大纲，优先保证“点开就停不下”。

硬性规则：
1. 黄金三章必须严格执行：
- 第1章：主角受压 + 明确敌人 + 强钩子。
- 第2章：金手指显效或底牌亮相。
- 第3章：首次打脸兑现（必须有可见结果）。
2. 每章必须包含：冲突事件 + 爽点兑现 + 本章收益 + 章末卡点。
3. 每3章一个小高潮，每8-12章一个大高潮。
4. 不能连续两章纯铺垫；若压抑，1章内必须反打。
5. 每章至少推进一个变量：战力、地位、资源、关系、信息。

输出格式（每章都按此格式，不可省略字段）：
第n章｜[吸睛标题，建议12-18字]
- 开场钩子（1句）：
- 本章冲突（谁压谁）：
- 本章爽点兑现（具体动作与结果）：
- 本章收益（战力/地位/资源/关系/信息）：
- 章末卡点（必须逼读者点下一章）：
- 情绪曲线（如：憋屈->反击->超爽）：
- 张力星级：★☆☆☆☆ 到 ★★★★★
- 一句话剧情：

补充要求：
- 标题避免平铺直叙，优先反差、悬念、冲突词。
- 不写悲剧收尾，压抑只服务下一波爆发。
- 所有章节必须符合【${params.novelArchitecture ? '既定架构' : '小说类型'}】风格与情感基调。

仅给出最终文本，不要解释任何内容。
`

/**
 * 分块章节大纲提示词
 * 用于分批生成章节
 */
export const blueprintChunked = (params) => `
基于以下元素：
- 内容指导：${params.userGuidance || '无'}
- 小说架构：
${params.novelArchitecture}

需要生成总共${params.numberOfChapters}章的节奏分布，

当前已有章节目录（若为空则说明是初始生成）：
${params.chapterList || '(无)'}

现在请设计第${params.startChapter}章到第${params.endChapter}章的节奏分布：

硬性规则（延续番茄风格）：
1. 必须和“当前已有章节目录”无缝衔接，不能改写已发生事件。
2. 每章都要有实质进展（至少推进1个变量：战力/地位/资源/关系/信息）。
3. 每章都要有“爽点兑现”和“章末卡点”，禁止纯过渡章。
4. 每3章安排一次小高潮，确保区间内有一次明确打脸或重大收获。
5. 若出现主角受压，下一章必须给到反击回收。

输出格式（每章都按此格式，不可省略字段）：
第n章｜[吸睛标题]
- 承接点（与前章如何衔接）：
- 本章冲突：
- 本章爽点兑现：
- 本章收益：
- 章末卡点：
- 情绪曲线：
- 张力星级：★☆☆☆☆ 到 ★★★★★
- 一句话剧情：

要求：
- 用短句、硬信息表达，避免空泛描述。
- 禁止虐主连续拉长线，压抑必须快速回收。

仅给出最终文本，不要解释任何内容。
`

/**
 * 第一章草稿提示词
 */
export const firstDraft = (params) => `
即将创作：第 ${params.chapterNumber} 章《${params.chapterTitle}》
本章定位：${params.chapterRole}
核心卖点：${params.chapterPurpose} (注意：这是本章最能留住读者的点)
情绪调动：${params.suspenseLevel}
断章钩子：${params.foreshadowing}
本章简述：${params.chapterSummary}

参考文档：
- 小说设定：
${params.novelSetting}

你是番茄日更作者，请直接写“可发布正文”，目标是让读者快速追更。

写作硬指标（必须执行）：
1. 前120字必须出现：主角 + 冲突对象 + 具体动作，禁止背景铺垫开场。
2. 每400-600字必须出现一次“冲突升级或爽点兑现”。
3. 对话占比建议30%-60%，段落短，动词密度高，减少大段心理独白。
4. 本章必须兑现“${params.chapterPurpose}”，不能只铺垫不回收。
5. 至少出现一次围观者/对手反应，放大主角含金量。
6. 结尾最后两段必须形成断章卡点（危机未解/新敌登场/更大机缘三选一）。
7. 禁止连续回忆杀、空洞哲思、超过120字纯景物描写。
8. ⚠️ 字数必须在 ${params.wordNumber} 字左右（误差不超过10%）！如果目标是3000字，就写2700-3300字之间！

风格要求（番茄向）：
- 句子偏短，信息密度高，情绪词明确。
- 冲突先行，解释后置，避免慢热。
- 压抑只作为反打前置，不能拖沓。

格式要求：
- 仅返回章节正文文本；
- 不使用分章节小标题；
- 不要使用markdown格式。

额外指导：${params.userGuidance || '(无)'}
`

/**
 * 后续章节草稿提示词
 */
export const nextDraft = (params) => `
参考文档：
└── 前文摘要：
    ${params.globalSummary}

└── 前章结尾段（注意接上这个钩子）：
    ${params.previousChapterExcerpt}

└── 角色状态（注意主角现在的强弱）：
    ${params.characterState}

当前章节信息：
第${params.chapterNumber}章《${params.chapterTitle}》：
├── 核心卖点：${params.chapterPurpose} (本章爽点)
├── 情绪调动：${params.suspenseLevel}
├── 断章钩子：${params.foreshadowing}
├── 章节简述：${params.chapterSummary}
└── 字数要求：${params.wordNumber}字

下一章节预告（仅供参考衔接方向，绝对不要写下一章内容！）：
第${params.nextChapterNumber}章《${params.nextChapterTitle}》：
└── 【内容保密】本章写到断章钩子就停！下一章的任何内容都不能在本章出现！

你是番茄日更作者，请创作第 ${params.chapterNumber} 章可发布正文。

████████████████████████████████████████
█  严 重 警 告  █
████████████████████████████████████████
🚫 字数上限：${Math.round(params.wordNumber * 1.1)}字，超过即失败！
🚫 禁止越界：绝对不能写第${params.nextChapterNumber}章的内容！
🚫 宁可少写500字，也绝对不能越界！
████████████████████████████████████████

写作硬指标（必须执行）：
1. 第一段必须直接承接上一章钩子中的动作/事件，不得重开新场景。
2. 每400-600字至少一次冲突升级或爽点兑现。
3. 本章必须兑现“${params.chapterPurpose}”，并与下一章卖点形成连锁期待。
4. 至少写一次围观反应或对手失态，强化主角压制力。
5. 严格遵守角色状态一致性（伤势、道具、战力、关系不得无故跳变）。
6. 若出现新能力/新道具，必须给出来源或触发动作。
7. 结尾必须留断章钩子，且与“${params.nextChapterTitle}”自然衔接。
8. ⚠️ 字数必须在 ${params.wordNumber} 字左右（误差不超过10%）！如果目标是3000字，就写2700-3300字之间！

风格要求（番茄向）：
- 短句推进，冲突优先，对话驱动。
- 少解释，多结果；少铺陈，多反应。
- 禁止大段回忆、空泛抒情、脱离主线的闲笔。

格式要求：
- 仅返回章节正文文本；
- 不使用分章节小标题；
- 不要使用markdown格式。

额外指导：${params.userGuidance || '(无)'}
`

/**
 * 章节扩写提示词
 * "增爽扩写"而非灌水
 */
export const enrich = (params) => `
以下网文章节字数不足，请进行**"增爽扩写"**（不是灌水！）：

目标字数：接近 ${params.wordNumber} 字。

---

**【扩写核心原则】**
扩写的目的是"让爽点更爽"，不是"让字数更多"。

**【具体扩写技巧】**（必须使用至少3条）

1. **放大围观反应**
   - 加入旁观者的惊呼、议论、表情变化
   - 例：「周围众人倒吸一口凉气，有人甚至不可置信地揉了揉眼睛。」
   - 例：「"这...这怎么可能！"人群中爆发出一阵惊叹。」

2. **延长对手失态**
   - 描写对手的表情变化：不屑 → 震惊 → 恐惧 → 绝望
   - 加入对手的内心崩溃独白
   - 例：「他的瞳孔骤然收缩，嘴角的冷笑僵在脸上，变成了一种难以置信的惊恐。」

3. **补充动作细节**
   - 把"一招制敌"拆成2-3个分解动作
   - 加入感官描写：声音、光影、气势
   - 例：「剑光一闪，快到肉眼几乎捕捉不到。只听"铛"的一声脆响，对方的兵器已经脱手飞出。」

4. **强化收益落地**
   - 明确主角获得了什么（战利品/声望/关系）
   - 用具体数字或对比来量化收益
   - 例：「这一战后，他在宗门的排名直接从末位跃升至前十。」

5. **加强预期铺垫**
   - 在爽点之前，加一段"所有人都不看好"的铺垫
   - 用"谁都没想到..."来制造反差
   - 例：「没有人觉得他能赢。毕竟，对面可是宗门第一天才。」

6. **延长高光时刻**
   - 用慢镜头写法，把高潮瞬间拉长
   - 加入主角的霸气台词或冷笑
   - 例：「他缓缓收起手中的剑，嘴角勾起一抹淡笑："还有谁？"」

---

**【硬性规则】**
1. 不改变原有事件顺序、角色结论、章节结尾钩子。
2. 新增内容必须是"有效内容"：冲突拉扯、打脸细节、围观反应、收益落地。
3. 禁止同义重复、段落注水、无意义旁白、空泛心理活动。
4. 扩写后的阅读体验必须比原文更爽。

---

原内容：
${params.chapterText}

---

要求：
- 仅给出最终文本，不要解释任何内容；
- 语言风格保持番茄快节奏、强冲突、强反馈。
`

/**
 * 导出所有章节类提示词
 */
export const chapterPrompts = {
   blueprint,
   blueprintChunked,
   firstDraft,
   nextDraft,
   enrich
}
